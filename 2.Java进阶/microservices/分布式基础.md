# 1.分布式理论

参考：https://blog.csdn.net/yeyazhishang/article/details/80758354

## 1.1.CAP定理

CAP定理又称CAP原则，指的是在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），最多只能同时满足三个特性中的两个，三者不可兼得

|      **属性**       | **含义**                                        |
| :-----------------: | ---------------------------------------- |
|     Consistency     | 一致性，意味着一个节点更新操作成功后，所有节点在同一时刻  数据必须保持一致性；对于客户端而言，一致性指并发访问更新后的数据如何获取？而对于服务端而言，一致性指更新的数据如何实时广播到整个系统？ |
|    Availability     | 高可用性，意味着服务不中断，一直处于可用状态                 |
| Partition tolerance | 分区容错性，意味着某节点或网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务，如：一个集群节点宕机了，剩下的机器还能够继续提供服务，使整个系统继续正常运转 |

CAP三个特性只能满足其中两个，那么取舍的策略就共有三种：
| <span style="white-space:nowrap;width:150px;">搭配策略</span> | **效果**|
|:---------------------|:----------------------------------------------|
| CA without P | 不要求系统分区，意味着系统难以扩展，分布式节点受限，没办法部署子节点，这是违背分布式系统设计的初衷。这种搭配现实不会采用 |
| CP without A | 不要求系统高可用性，但每个请求都需要在服务器之间保持强一致，而P（分区）会导致同步时间无限延长(也就是等待数据同步完才能正常访问服务)，一旦发生网络故障或者消息丢失等情况，就要牺牲用户的体验，等待所有数据全部一致了之后再让用户访问系统。设计成CP的系统其实不少，最典型的就是分布式数据库，如Redis、HBase等。对于这些分布式数据库来说，数据的一致性是最基本的要求 |
| AP wihtout C | 要高可用性并且允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。典型的应用就如电商的抢购手机场景，可能前几秒你浏览商品的时候页面提示是有库存的，当你选择完商品准备下单的时候，系统提示你下单失败，商品已售完。这其实就是先在 A（可用性）方面保证系统可以正常的服务，然后在数据的一致性方面做了些牺牲，虽然多少会影响一些用户体验，但也不至于造成用户购物流程的严重阻塞 |

